<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>TheWrkShop — Blog Archive</title>
  <link rel="stylesheet" href="style.css"/>
  <link rel="icon" type="image/x-icon" href="assets/favicon/favicon.ico">
  <meta name="description" content="Browse past blog posts from TheWrkShop."/>
  <style>
    .archive-grid.preload { visibility: hidden; }
    .page-hero { background:#3e2c23; color:#f4f1ee; padding:3rem 1rem; text-align:center; }
    .page-hero h1 { font-size:clamp(1.8rem,3vw,2.6rem); margin-bottom:.4rem; }
    .page-hero p { opacity:.95; max-width:720px; margin:0 auto; }
    .container { max-width:1100px; margin:0 auto; padding:0 1rem; }
    .cards { display:grid; gap:1rem; grid-template-columns:repeat(3,1fr); }
    .blog-card { background:#f4f1ee; border:1px solid rgba(0,0,0,.08); border-radius:14px; padding:1rem; text-decoration:none; color:#2b2b2b; display:block; }
    .badge { display:inline-block; font-size:.8rem; font-weight:700; background:#3e2c23; color:#f4f1ee; padding:.15rem .55rem; border-radius:999px; }
    .meta { display:flex; gap:.5rem; align-items:center; color:#6b5b53; font-size:.9rem; margin:.25rem 0 .5rem; }
    .empty { text-align:center; padding:2rem; color:#6b5b53; }
    @media (max-width: 1020px){ .cards { grid-template-columns:repeat(2,1fr);} }
    @media (max-width: 640px){ .cards { grid-template-columns:1fr; } }
  </style>
</head>
<body>
  <div id="site-header"></div>

  <section class="page-hero">
    <h1>Blog Archive</h1>
    <p>Weekly articles to build men of purpose and excellence.</p>
  </section>

  <main class="content-section container">
    <section class="cards archive-grid preload" id="blogGrid" aria-label="Blog posts"></section>
    <p class="empty" id="emptyMsg" style="display:none">No posts yet.</p>
  </main>

  <footer>
    <div class="footer-content">
      <div class="footer-logo"><span class="sitename"></span></div>
      <p>&copy; 2025 <span class="sitename"></span>. All rights reserved.</p>
    </div>
  </footer>

  <script src="script.js"></script>
  <script>
  (function(){
    document.querySelectorAll('.sitename').forEach(el => el.textContent = 'TheWrkShop');

    const grid = document.getElementById('blogGrid');
    const empty = document.getElementById('emptyMsg');

    function card(o){
      const a = document.createElement('a');
      a.className = 'blog-card';
      a.href = o.href;
      a.innerHTML = `
        <span class="badge">${o.category || 'Article'}</span>
        <h3>${o.title}</h3>
        <div class="meta">
          <time datetime="${o.date}">${new Date(o.date+'T00:00:00').toLocaleDateString(undefined,{month:'short',day:'numeric',year:'numeric'})}</time>
          <span>• ${o.reading_minutes || 0} min</span>
        </div>
        <p>${o.excerpt || ''}</p>
      `;
      return a;
    }

    (async function(){
      try{
        const r = await fetch('/data/blog-archive.json?ts=' + Date.now(), { cache:'no-store' });
        if(!r.ok) throw 0;
        const list = await r.json();
        // Guard against future (shouldn't be present, but belt & suspenders)
        const today = new Intl.DateTimeFormat('en-CA', { timeZone: 'America/Chicago', year:'numeric', month:'2-digit', day:'2-digit' }).format(new Date());
        const items = (Array.isArray(list) ? list : []).filter(x => x.date && x.date <= today);

        grid.classList.remove('preload');
        grid.innerHTML = '';
        if (!items.length) { empty.style.display=''; return; }
        items.forEach(x => grid.appendChild(card(x)));
      }catch(e){
        grid.classList.remove('preload');
        empty.style.display = '';
      }
    })();
  })();
  </script>
</body>
</html>
